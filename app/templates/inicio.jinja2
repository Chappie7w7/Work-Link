{% import "components/navbar.jinja2" as navbar %}
{% import "components/footer.jinja2" as footer %}
{% import "components/flash_messages.jinja2" as flash %}

<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inicio - Worklink</title>
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    <meta name="theme-color" content="#2563eb">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='icons/icon-192x192.png') }}">
    <link rel="icon" type="image/png" sizes="192x192" href="{{ url_for('static', filename='icons/icon-192x192.png') }}">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='icons/icon-192x192.png') }}">
    
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style_inicio.css') }}">
</head>

<body>
{{ navbar.navbar(current_user) }}
{{ flash.render_flash_messages() }}

    <section class="inicio-p">
        <div class="main-content">
            <!-- Columna izquierda: perfil del usuario -->
            <div class="column left-column">
                <div class="box perfil-box">
                    <div class="circle"></div>
                    <h3>{{ current_user.nombre if current_user else '' }}</h3>
                    <p>📧 {{ current_user.correo if current_user else '' }}</p>
                    {% if current_user.ubicacion %}
                    <p>📍 {{ current_user.ubicacion }}</p>
                    {% endif %}
                </div>
                <div class="box empty-box"></div>
            </div>
            <!-- Columna central: presentación -->
            <div class="column center-column">
                <div class="box" style="font-weight: bold;">
                    🚀 Reduce tiempo y esfuerzo en la búsqueda de Trabajo y contratación en Ocosingo
                </div>
                <div class="box">
                    <h4 class="section-title">📊 Estadísticas de la Plataforma</h4>
                    <div class="stats-grid">
                        <div class="stat-item blue">
                            <div class="stat-number blue">{{ total_empresas if total_empresas else 0 }}+</div>
                            <div class="stat-label">Empresas</div>
                        </div>
                        <div class="stat-item green">
                            <div class="stat-number green">{{ total_usuarios if total_usuarios else 0 }}+</div>
                            <div class="stat-label">Usuarios</div>
                        </div>
                        <div class="stat-item purple">
                            <div class="stat-number purple">{{ total_vacantes if total_vacantes else 0 }}+</div>
                            <div class="stat-label">Vacantes</div>
                        </div>
                    </div>
                </div>
                <div class="box">
                    <h4 class="section-title">🎯 ¿Por qué elegir WorkLink Ocosingo?</h4>
                    <div class="features-grid">
                        <div class="feature-item blue">
                            <div class="feature-title">🏢 Empresas Locales</div>
                            <div class="feature-description">Conexión directa con empresas de Ocosingo</div>
                        </div>
                        <div class="feature-item green">
                            <div class="feature-title">⚡ Proceso Ágil</div>
                            <div class="feature-description">Contratación rápida y eficiente</div>
                        </div>
                        <div class="feature-item purple">
                            <div class="feature-title">🌍 Región Completa</div>
                            <div class="feature-description">Oportunidades en toda Chiapas</div>
                        </div>
                        <div class="feature-item orange">
                            <div class="feature-title">🎯 Soporte Personal</div>
                            <div class="feature-description">Atención personalizada y local</div>
                        </div>
                    </div>
                </div>
                <div class="box">
                    <h4 class="section-title">🌟 Últimas Oportunidades</h4>
                    <p class="opportunities-section">
                        Descubre las nuevas vacantes disponibles en Ocosingo y alrededores.
                        ¡Tu próximo empleo te está esperando!
                    </p>
                    <div class="opportunities-buttons">
                        <a href="{{ url_for('EmpleosRoute.empleos') }}" class="opportunity-btn blue">
                            Ver Empleos
                        </a>
                        <a href="{{ url_for('PlanesRoute.planes') }}" class="opportunity-btn green">
                            Ver Planes
                        </a>
                    </div>
                </div>
            </div>

            <!-- Columna derecha -->
            <div class="column right-column">
                <div class="box">
                    <h4 class="activity-title">📈 Actividad Reciente</h4>
                    <div class="activity-list">
                        {% if actividades %}
                            {% for act in actividades %}
                            <div class="activity-item {{ act.color }}">
                                <div class="activity-title-text">{{ act.titulo }}</div>
                                <div class="activity-description">{{ act.descripcion }}</div>
                                <div class="activity-time">{{ act.tiempo }}</div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="activity-item blue">
                                <div class="activity-title-text">Sin actividad reciente</div>
                                <div class="activity-description">Aún no hay actividades registradas</div>
                                <div class="activity-time">Ahora</div>
                            </div>
                        {% endif %}
                    </div>
                </div>
                <div class="box">
                    <h4 class="companies-title">🏆 Empresas Destacadas</h4>
                    <div class="companies-list">
                        {% if empresas_destacadas %}
                            {% set colores = ['blue', 'orange', 'green', 'purple'] %}
                            {% for empresa in empresas_destacadas %}
                            <div class="company-item">
                                <div class="company-avatar {{ colores[loop.index0 % 4] }}">{{ empresa.inicial }}</div>
                                <div class="company-info">
                                    <div class="company-name">{{ empresa.nombre }}</div>
                                    <div class="company-vacancies">{{ empresa.vacantes }} vacante{{ 's' if empresa.vacantes != 1 else '' }} activa{{ 's' if empresa.vacantes != 1 else '' }}</div>
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="company-item">
                                <div class="company-avatar blue">?</div>
                                <div class="company-info">
                                    <div class="company-name">Sin empresas registradas</div>
                                    <div class="company-vacancies">0 vacantes activas</div>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Llamar al componente footer -->

    </section>
    <!-- Llamar al componente footer -->
    {{ footer.footer() }}
    <!-- Inicializar AOS -->
    <script>
        AOS.init();
    </script>
    
    <!-- Service Worker -->
    <script>
        if ("serviceWorker" in navigator) {
            navigator.serviceWorker.register("{{ url_for('static', filename='service-worker.js') }}")
                .then(() => console.log("✅ Service Worker registrado"))
                .catch(err => console.log("❌ Error registrando SW:", err));
        }
    </script>
</body>

</html>